!function(o,t){function e(t,e){var n=[],l=o(window).height(),r=o("body").scrollTop()||o("html").scrollTop(),i=0,s=0,a=0,c=null;return o.each(e,function(){if(c=o(this),i=c.offset().top,s=c.outerHeight(),a=i+s,a>r&&r+l>i){var t=0;r>=i&&(t=a-r),i>r&&r+l>i&&(t=r+l-i),n.push({floor:c,ch:t})}}),n.length>0?(n.sort(function(o,t){return o.ch<t.ch?-1:1}),1==n.length&&n[n.length-1].floor.attr(t.options.dataIdex)==e.length-1&&n[n.length-1].ch<t.options.onOutDist?null:n.pop().floor):null}function n(t,e){var n=t.options;if("auto"==n.threshold)e?t.elevatorBox.show():t.elevatorBox.hide();else if(null!=n.threshold){var l=o("body").scrollTop()||o("html").scrollTop(),r=n.threshold;n.threshold instanceof o&&(r=n.threshold.offset().top),r>l?t.elevatorBox.hide():t.elevatorBox.show()}}function l(o,t,e){o.removeClass(e),t.addClass(e)}function r(t,e){var n=o("body,html");t.effectSmooth&&n.stop(),n.animate({scrollTop:t.top},t.delay,t.easing,function(){e&&(e(),e=null)})}function i(o,t,e,n){return{handler:o[n],floor:t[n],from:e||-1,to:n}}function s(o){return new a(this,o)}var a=function(t,e){var n,s=this;if(s.init=!0,s.isScrolling=!1,s.scrolltimer=-1,s.resizetimer=-1,s.scrollThread=-1,s.resizeThread=-1,s.currentIdx=-1,s.isPlay=!1,s.el=o(t),n=s.options=o.extend({},a.DEFAULTS,e||{}),s.floorList=s.el.find("."+n.floorClass),s.elevatorBox=o("."+n.elevatorClass),s.handlers=s.elevatorBox.find("."+n.handlerClass),s.install(),o(window).bind("scroll",function(){clearTimeout(s.scrolltimer),s.scrolltimer=setTimeout(function(){clearTimeout(s.scrolltimer),s.onScroll()},50)}),o(window).bind("resize",function(){clearTimeout(s.resizetimer),s.resizetimer=setTimeout(function(){clearTimeout(s.resizetimer),s.onResize()},50)}),n.event){var c=-1;s.handlers.on(n.event,function(t){var e=o(this),a=e.attr(n.dataIdex),u=o(s.floorList).eq(a),h=s.currentIdx,d=null;clearTimeout(c),s.isPlay=!0,s.currentIdx=a,d=i(s.handlers,s.floorList,h,a),o.isFunction(n.onStart)&&n.onStart.call(s,d),n.selectClass&&l(s.handlers,e,n.selectClass),r({top:u.offset().top+n.floorScrollMargin,delay:n.delay,easing:n.easing,effectSmooth:n.effectSmooth},function(){o.isFunction(n.onEnd)&&n.onEnd.call(s,d),c=setTimeout(function(){s.isPlay=!1},100),s.elevatorBox.show()}),t.preventDefault()})}};a.DEFAULTS={floorClass:"ui-floor",elevatorClass:"ui-elevator",handlerClass:"ui-handlers",selectClass:null,event:"click",delay:300,easing:"swing",effectSmooth:!0,threshold:"auto",floorScrollMargin:0,dataIdex:"data-idx",onOutMargin:0,onStart:null,onEnd:null,onOut:null,onResizeCallback:null},a.prototype.install=function(){var t=this,e=this.options;t.floorList.each(function(t){o(this).attr(e.dataIdex,t)}),t.handlers.each(function(t){o(this).attr(e.dataIdex,t)}),t.onScroll()},a.prototype.onScroll=function(){var t=this;this.options;t.isPlay||(t.isScrolling||(t.isScrolling=!0,o.isFunction(t.onStart)&&t.onStart()),clearTimeout(t.scrollThread),t.scrollThread=setTimeout(function(){var l=!1,r=e(t,t.floorList);r&&(l=!0,o.isFunction(t.onEnd)&&t.onEnd.call(t,r)),n(t,l),l||o.isFunction(t.onOut)&&t.onOut.call(t),t.isScrolling=!1},200))},a.prototype.onResize=function(){var t=this,e=this.options;clearTimeout(t.resizeThread),t.resizeThread=setTimeout(function(){o.isFunction(e.onResizeCallback)&&e.onResizeCallback.call(t)},200)},a.prototype.onStart=function(){var t=this,e=this.options;o.isFunction(e.onStart)&&e.onStart.call(t,i(t.handlers,t.floorList))},a.prototype.onEnd=function(t){var e=this,n=this.options;if(t){var r=t.attr(n.dataIdex),s=e.currentIdx;if(e.currentIdx=r,r<e.handlers.length&&r>-1){var a=o(e.handlers.filter("["+n.dataIdex+"="+r+"]"));if(!a||a.length<1)return!1;l(e.handlers,a,n.selectClass),o.isFunction(n.onEnd)&&n.onEnd.call(e,i(e.handlers,e.floorList,s,r))}}},a.prototype.onOut=function(){var t=this,e=this.options;e.selectClass&&t.handlers.removeClass(e.selectClass),o.isFunction(e.onOut)&&e.onOut.call(t,t.elevatorBox)},o.fn.elevator=s,o.fn.elevator.Constructor=a}(jQuery);